@model Piranha.Models.Manager.PostModels.EditModel
@{
    ViewBag.Selected = "Post" ;   
}
@section Head {
    @Html.Partial("~/Areas/Manager/Views/Shared/Partial/TinyMCE.cshtml")
    <script type="text/javascript">
        $(document).ready(function () {
            $("#PostCategories").chosen().change(function () {
                console.log("change");
                var container = $(this).siblings(".chzn-container");

                $.each($(this).find("option"), function (n, opt) {
                    $(opt).removeAttr("selected");
                    $.each(container.find(".result-selected"), function (i, e) {
                        if ($(e).html() == $(opt).html())
                            $(opt).attr("selected", "selected");
                    });
                });
            });
        });
    </script>
}

@section Toolbar {
<div class="grid_12 toolbar">
    <div class="inner">
        <ul>
            <li><a class="save submit"></a>
                <div class="tooltip"><p>@Piranha.Resources.Global.ToolbarSave</p></div></li>
            <li><a class="publish"></a>
                <div class="tooltip"><p>@Piranha.Resources.Global.ToolbarPublish</p></div></li>
            <li><a href="@Url.Action("Delete", new { id = Model.Post.Id })" class="delete"></a>
                <div class="tooltip"><p>@Piranha.Resources.Global.ToolbarDelete</p></div></li>
            <li><a href="@Url.Action("Index", "Post")" class="back"></a>
                <div class="tooltip"><p>@Piranha.Resources.Global.ToolbarBack</p></div></li>
            <li><a href="" class="refresh"></a>
                <div class="tooltip"><p>@Piranha.Resources.Global.ToolbarReload</p></div></li>
            <li><a href="" class="info"></a>
                <div class="tooltip"><p>@Piranha.Resources.Global.ToolbarHelp</p></div></li>
        </ul>
        <div class="clear"></div>
    </div>
</div>
}

@{ Html.BeginForm("Edit", "Post") ; }
<div>
    @Html.HiddenFor(m => m.Post.IsNew)
    @Html.HiddenFor(m => m.Post.Id)
    @Html.HiddenFor(m => m.Post.IsDraft)
    @Html.HiddenFor(m => m.Post.Permalink)
    @Html.HiddenFor(m => m.Post.TemplateId)
    @Html.HiddenFor(m => m.Post.Created)
    @Html.HiddenFor(m => m.Post.Updated)
    @Html.HiddenFor(m => m.Post.Published)
    @Html.HiddenFor(m => m.Post.LastPublished)
    @Html.HiddenFor(m => m.Post.CreatedBy)
    @Html.HiddenFor(m => m.Post.UpdatedBy)
    @Html.HiddenFor(m => m.Permalink.IsNew)
    @Html.HiddenFor(m => m.Permalink.Id)
    @Html.HiddenFor(m => m.Permalink.ParentId)
    @Html.HiddenFor(m => m.Permalink.Type)
    @Html.HiddenFor(m => m.Permalink.Name)
    @Html.HiddenFor(m => m.Permalink.Created)
    @Html.HiddenFor(m => m.Permalink.CreatedBy)
    <input type="hidden" id="draft" name="draft" value="true" />
</div>
<div class="grid_9">
    <div class="box">
        <div class="title"><h2>@Piranha.Resources.Global.Information</h2></div>
        <div class="inner">
            <ul class="form">
                <li>@Html.LabelFor(m => m.Post.Title)
                    <div class="input">
                        @Html.TextBoxFor(m => m.Post.Title)</div>
                    @Html.ValidationMessageFor(m => m.Post.Title)
                </li>
                <li>@Html.LabelFor(m => m.Post.Permalink)
                	@if (!Model.Post.IsNew) {
                    <p>http://@Request.Url.DnsSafeHost@Url.GetPermalink(Model.Post.Permalink).ToLower()</p>
                    } else {
                    <p><i>@Piranha.Resources.Post.PermalinkDescription</i></p>
                    }
                </li>
                <li>
                    @Html.LabelFor(m => m.Post.Excerpt)
                    <div class="input">
                        @Html.TextAreaFor(m => m.Post.Excerpt, new { @placeholder = Piranha.Resources.Global.Optional, @rows = 3 })</div>
                    @Html.ValidationMessageFor(m => m.Post.Excerpt)
                </li>
            </ul>
        </div>
    </div>

    <div class="box">
        <div class="title"><h2>@Piranha.Resources.Global.Content</h2></div>
        <div class="inner">
            <div class="input">
                @Html.TextAreaFor(m => m.Post.Body, new { @class ="editor", @rows = 10 })
            </div>
        </div>
    </div>
</div>
<div class="grid_3">
    <div class="box pagetemplate overflow">
        <div class="title"><h2>@Piranha.Resources.Global.Categories</h2></div>
        <div class="inner">
            <select name="PostCategories" class="chzn-select" style="width:190px" multiple="multiple">
                @foreach (var opt in Model.Categories) {
                <option@(opt.Selected ? " selected=selected" : "") value="@opt.Value">@opt.Text</option>
                }
            </select>
        </div>
    </div>
</div>
@{ Html.EndForm() ; }